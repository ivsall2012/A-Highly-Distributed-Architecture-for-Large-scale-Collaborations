[Switch to English](https://github.com/ivsall2012/A-Highly-Distributed-Architecture-for-Large-scale-Collaborations/blob/EN/warm-up.md)

# å‰è¨€
ä»¥ä¸‹çš„è¿™äº›éƒ½æ˜¯æˆ‘ä¹‹å‰æ‰€çŠ¯è¿‡å¾—é”™è¯¯å’Œä¸€äº›è‡ªè®¤ä¸ºæ¯”è¾ƒå¥½çš„ç»éªŒã€‚åœ¨çœ‹æˆ‘çš„[ç»„ä»¶åŒ–æ–¹æ¡ˆ](https://github.com/ivsall2012/A-Highly-Distributed-Architecture-for-Large-scale-Collaborations/blob/master/SRA.md)ä¹‹å‰, æˆ‘è§‰å¾—è¿™äº›é”™è¯¯å’Œç»éªŒå€¼å¾—åˆ†äº«ä¸€ä¸‹ã€‚
å¦‚æœæœ‰ä»€ä¹ˆåœ°æ–¹ä¸å¯¹çš„ï¼Œå€¼å¾—è®¨è®ºçš„ï¼Œè¯·å„ä½ä¸€å®šè¦æå‡ºæ¥ğŸ˜ƒ  


## ç›®å½•
- [1. æ•´ä¸ªå›¢é˜Ÿéƒ½åœ¨ä¸€ä»½é¡¹ç›®é‡Œè¿›è¡Œå¼€å‘](#1-æ•´ä¸ªå›¢é˜Ÿéƒ½åœ¨ä¸€ä»½é¡¹ç›®é‡Œè¿›è¡Œå¼€å‘)
- [2. é¡¹ç›®ä¸­é»‘æ´ä¼¼çš„"core","common"](#2-é¡¹ç›®ä¸­é»‘æ´ä¼¼çš„core-common)
- [3. æ¨ªå‘ä¾èµ–](#3-æ¨ªå‘ä¾èµ–)
- [4. å‚ç›´ä¾èµ–](#4-å‚ç›´ä¾èµ–)
- [5. é—­åŒ…(block)çš„ä½¿ç”¨](#5-é—­åŒ…blockçš„ä½¿ç”¨)
    - [Pros](#pros)
    - [Cons](#cons)
    - [ä»€ä¹ˆæ—¶å€™ç”¨](#ä»€ä¹ˆæ—¶å€™ç”¨)
- [6. å±•ç¤ºå±‚](#6-å±•ç¤ºå±‚)
- [7. ç½‘ç»œå±‚](#7-ç½‘ç»œå±‚)
- [8. æœ¬åœ°æŒä¹…åŒ–](#8-æœ¬åœ°æŒä¹…åŒ–)
    - [CoreData](#coredata)
    - [Realm](#realm)
    - [SQLite](#sqlite)
    - [æ€æ ·åˆ‡å‰²æ•°æ®æ¨¡å‹](#æ€æ ·åˆ‡å‰²æ•°æ®æ¨¡å‹)
    - [æ€æ ·æŠŠJSONè½¬æˆåŸå§‹æ¨¡å‹](#æ€æ ·æŠŠjsonè½¬æˆåŸå§‹æ¨¡å‹)
- [9. ä¸€ä¸ªå¤šä»£ç†è®¾è®¡æ¨¡å¼](#9-ä¸€ä¸ªå¤šä»£ç†è®¾è®¡æ¨¡å¼)


### 1. æ•´ä¸ªå›¢é˜Ÿéƒ½åœ¨ä¸€ä»½é¡¹ç›®é‡Œè¿›è¡Œå¼€å‘
åƒä¸‡ä¸è¦è¿™æ ·åšï¼ï¼ï¼
ä½ è‡³å°‘è¦æŠŠä½ çš„å„ä¸ªåŠŸèƒ½ç”¨[Cocoapodsçš„pod module](https://guides.cocoapods.org/making/using-pod-lib-create.html)è¿›è¡Œé¡¹ç›®é¢—ç²’åŒ–ã€‚æŠŠè¿™äº›podéƒ½æ”¾åˆ°ä½ ä»¬è‡ªå·±çš„ç§æœ‰åº“é‡Œé¢ï¼Œè¦ä»€ä¹ˆå°±å¯¼å…¥ä»€ä¹ˆï¼Œç”¨å°±å¾—äº†ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªmain project ä½œä¸ºä¸€ä¸ªä¸»é¡¹ç›®æŠŠæ‰€æœ‰çš„åŠŸèƒ½éƒ½ç»„ç»‡è¿›å»ã€‚è¿™æ ·ä½ è¿˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨å„ä¸ªé¢—ç²’åŒ–çš„podé‡Œé¢åšå•å…ƒæµ‹è¯•ã€‚è€Œä¸”ä½ ä¹Ÿå°‘äº†å¾ˆå¤šåœ¨GitHubä¸Šçš„conflitï¼Œç‰¹åˆ«æ˜¯storyboard, xibçš„conflictã€‚  
ä½ å¯èƒ½è§‰å¾—ä½ ä»¬å›¢é˜Ÿä¹Ÿå°±é‚£ä¹ˆ2ã€3ä¸ªäººï¼Œæ ¹æœ¬ä¸è¦ç´§çš„ã€‚ä½†æ˜¯ä½ çš„å…¬å¸ï¼Œä½ çš„å›¢é˜Ÿï¼Œä½ çš„ç”¨æˆ·éœ€æ±‚æ˜¯ä¼šå¢é•¿çš„å•Šï¼ˆæœŸå¾…æ˜¯è¿™æ ·å§ï¼‰ã€‚ä¸ºä»€ä¹ˆè¦ç­‰åˆ°é—®é¢˜æ¥äº†å†è§£å†³å‘¢ã€‚ä¸€å¼€å§‹å°±åº”è¯¥æŠŠä¸€ä¸ªå¥åº·çš„æ¶æ„ç»™æå¥½ï¼Œè¿™æ ·æ›´ä¼šæé«˜å¼€å‘æ•ˆç‡ -- æ¯ä¸ªå¼€å‘è€…éƒ½æœ‰ä»–è‡ªå·±çš„å°å¤©åœ°ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½å¯¹åº”ç€ä¸€ä¸ªpod ä¸€ç›®äº†ç„¶ã€‚  
æˆ‘çš„ä¸‹ä¸€ç¯‡[ç»„ä»¶åŒ–çš„æ–‡ç« ](https://github.com/ivsall2012/A-Highly-Distributed-Architecture-for-Large-scale-Collaborations/blob/master/SRA.md)æå‡ºçš„æ–¹æ¡ˆä¼šæ¯”è¿™æ ·åªç”¨[Cocoapodsçš„pod module](https://guides.cocoapods.org/making/using-pod-lib-create.html)æ›´å¥½ã€‚å½“ç„¶å…ˆçœ‹å®Œè¿™ç¯‡æ–‡ç« å…ˆå§ å“ˆå“ˆã€‚  

### 2. é¡¹ç›®ä¸­é»‘æ´ä¼¼çš„"core", "common"
ä¸è¦æŠŠ"core","common"å½“ä½œåƒåœ¾å †ï¼Œä½¿åŠ²å¾€é‡Œæ‰”ä¸œè¥¿ï¼Œç­‰åˆ°çœŸæ­£éœ€è¦ä¸œè¥¿çš„æ—¶å€™ï¼Œä½ æ‰åˆ°åƒåœ¾å †é‡Œæ‰¾ä¸œè¥¿ï¼Œå„ç§â€œè…è‡­å‘³â€ã€‚  
æˆ‘å»ºè®®ä½ â€œç”¨åˆ°ä»€ä¹ˆå°±å¯¼å…¥ä»€ä¹ˆâ€ã€‚ä½ å°½åŠ›æŠŠå„ä¸ªæ¨¡å—çš„èŒèƒ½åˆ†ç±»å¥½ï¼Œæ¯”å¦‚ServerDomainNamesï¼ŒAudioPlayerNotificationsã€‚åœ¨æ¯”å¦‚StringExtensionå°±å¯ä»¥ä¸“é—¨ç”¨æ¥å¤„ç†stringçš„ï¼Œç”šè‡³å¯ä»¥ StringPrettyForLogin ä¸“ä¸ºloginæ¨¡å—ç”¨çš„string extensionï¼Œåå­—é•¿ä¸è¦ç´§çš„ã€‚  
æŠŠè¿™äº›æ¨¡å—éƒ½åšæˆpod moduleã€‚è¦ç”¨ä»€ä¹ˆå¯¼å…¥ä»€ä¹ˆï¼Œä¸€æ¸…äºŒæ¥šã€‚è€Œä¸æ˜¯ ä½ åªéœ€è¦ç”¨é‚£ä¹ˆ1ã€2ä¸ªåŠŸèƒ½ï¼Œè€ŒæŠŠé‚£ä¸ªåˆè‚¥åˆå¤§çš„"common"ç»™å¯¼å…¥è¿›æ¥ï¼Œ å…¥ä¾µä½ ç°æœ‰çš„åå­—ç©ºé—´ï¼Œæ²¡å¿…è¦ã€‚å¯¼å…¥çš„æ¨¡å—è¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·ç‹¬ç«‹æ€§ä¼šå¥½å¾ˆå¤šã€‚     
ä½ å¯èƒ½ä¼šé—®å¾ˆå¤šå¼€æºæ¡†æ¶ä¸æ˜¯éƒ½æœ‰"core","common"å—ï¼Ÿ  
ä½†æˆ‘æƒ³é—®ï¼Œä½ çš„â€œcoreâ€çœŸçš„æ˜¯COREå—ï¼Ÿäººå®¶æ¡†æ¶çš„"core"ï¼š1ï¼‰å¤šæ•°æƒ…å†µï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¹¶ä¸ä¼šå˜å¾—å¾ˆå¤§ã€‚è€Œä½ çš„ä¼šã€‚ 2ï¼‰è€Œä¸”åœ¨æ¡†æ¶å†…ï¼Œç”¨åˆ°çš„é‚£ä¸ª"core"é‡Œçš„åŠŸèƒ½çš„ç¡®éå¸¸éå¸¸é¢‘ç¹ï¼Œæœ‰ç‚¹åƒç³»ç»Ÿçš„kernel,æ²¡æœ‰å®ƒæ¡†æ¶è¿è¡Œä¸èµ·æ¥ã€‚è€Œä½ çš„"core"é‡Œçš„ä¸œè¥¿ ç”¨å¾—ä¸é‚£ä¹ˆé¢‘ç¹æˆ–è€…ä¸“ä¸€æ€§é«˜ å¦‚åªå¤„ç†stringçš„ä¸€äº›åŠŸèƒ½ã€‚  
æˆ‘å¹¶ä¸æ˜¯è¯´ç»å¯¹ä¸ç”¨ï¼Œå¦‚æœä½ çœŸæ­£æœ‰coreç­‰çº§çš„åŠŸèƒ½å’Œç±»ï¼Œå°±æ”¾é‡Œé¢å»å§ã€‚   
ä½†æ˜¯åˆ†é—¨åˆ«ç±»æ˜¯ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯å“¦:)  


### 3. æ¨ªå‘ä¾èµ–
æ¨ªå‘ä¾èµ–å°±æ˜¯2ä¸ªåŒç­‰çº§çš„æ¨¡å—ä¹‹é—´çš„ä¾èµ–ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªå•†å“æ¨¡å—å’Œä¸€ä¸ªè®¢å•æ¨¡å—ï¼Œä¸€ä¸ªæ’­å‘å™¨ç•Œé¢æ¨¡å—å’Œä¸€ä¸ªä¸“è¾‘é¦–é¡µæ¨¡å—ã€‚ä½†ä¸€ä¸ªç™»é™†éªŒè¯æ¨¡å—å’Œä¸€ä¸ªä¸»é¡µæ¨¡å—å°±ä¸æ˜¯æ¨ªå‘ä¾èµ–ï¼Œæ˜¯ä¸‹é¢ä¼šæåˆ°çš„å‚ç›´ä¾èµ–ã€‚  
æ€»çš„æ¥è¯´æ˜¯ä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„ä¾èµ–ã€‚æˆ‘ä»¬éœ€è¦æ¨ªå‘ä¾èµ– æ¥ä½¿ç”¨å…¶ä»–ä¸šåŠ¡æ¨¡å—çš„æœåŠ¡æˆ–è€…è·³è½¬åˆ°å®ƒä»¬çš„é¡µé¢ã€‚  
å…¶å®æ¨ªå‘ä¾èµ–æœ¬èº«æ˜¯å¾ˆâ€œåˆç†çš„â€ï¼Œæ¯”å¦‚ä¸€ä¸ªå•†å“æ¨¡å—é‡Œçš„â€œç«‹å³è´­ä¹°â€è¢«ç‚¹å‡»ä¹‹åï¼Œè‚¯å®šè¦è·³åˆ°è®¢å•æ¨¡å—çš„å•Šï¼Œä¾èµ–è®¢å•æ¨¡å—æœ‰é”™å—ï¼Ÿ    
åœ¨åº”ç”¨è¿˜å°çš„æ—¶å€™ï¼Œå‡ ä¹æ²¡æœ‰ï¼Œä½†éšç€éœ€æ±‚å’Œåº”ç”¨çš„å¢å¤§ï¼Œæ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„å°±ä¸ç‹¬ç«‹äº†ã€‚  
å¦‚æœä½ è¦æµ‹è¯•å•†å“æ¨¡å—ï¼Œé‚£ä¹ˆå®ƒæ‰€ä¾èµ–çš„è®¢å•æ¨¡å—è‚¯å®šä¼šè¢«å¯¼å…¥ï¼Œå› ä¸ºä½ éœ€è¦ä¾èµ–è®¢å•æ¨¡å—çš„è·³è½¬ä»£ç é€šè¿‡ç¼–è¯‘ã€‚ä½ å¯èƒ½è¯´æµ‹è¯•çš„æ—¶å€™æ³¨é‡Šæ‰å‘—ã€‚ä½†å¦‚æœä½ åˆæœ‰ä¸€ä¸ªå•†é“ºè¯¦æƒ…æ¨¡å—ï¼Œè¿˜æœ‰ä¸€ä¸ªè´­ç‰©è½¦æ¨¡å—ï¼Œè¿˜æœ‰ä¸€ä¸ªå®¢æœæ¨¡å—ç­‰ç­‰ï¼Œè€Œä¸”è·³è½¬ä»£ç åˆ†å¸ƒåœ¨å„ä¸ªè§’è½ï¼Œæ€ä¹ˆåŠï¼Ÿ  
æœ€å¥½çš„åŠæ³•å°±æ˜¯å»æ‰è¿™äº›æ¨¡å—ä¾èµ–ï¼ŒçŸ¥é“å¤–ç•Œçš„ä¿¡æ¯è¶Šå°‘è¶Šå¥½è¶Šå®¹æ˜“æµ‹è¯•å’Œè°ƒè¯•ã€‚è¿™æ ·æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶æˆ–è€…ä¸€ä¸ªrouteræ¥å¸®æˆ‘ä»¬è·³è½¬åˆ°è¿™äº›ç•Œé¢æˆ–è€…ä½¿ç”¨å…¶ä»–æ¨¡å—æä¾›çš„æœåŠ¡ã€‚ ä¸‹ä¸€ç¯‡ç»„ä»¶åŒ–çš„æ–‡ç« ï¼Œä¸»è¦å°±æ˜¯è§£å†³è¿™ä¸ªæ¨ªå‘ä¾èµ–çš„é—®é¢˜ï¼Œè®©æ‰€æœ‰ä¸šåŠ¡æ¨¡å—ç‹¬ç«‹å‡ºæ¥ï¼Œæ•´ä¸ªé¡¹ç›®å°±æ˜¯ä¸€ä¸ªå³æ’å³ç”¨çš„ç³»ç»Ÿã€‚  


### 4. å‚ç›´ä¾èµ–
å‚ç›´ä¾èµ–å°±æ˜¯æœåŠ¡æ¨¡å—ä¸è¢«æœåŠ¡æ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç™»é™†éªŒè¯æ¨¡å—å’Œä¸€ä¸ªä¸»é¡µæ¨¡å—ï¼Œä¸€ä¸ªæ’­æ”¾å™¨æ¨¡å—å’Œæ’­æ”¾å™¨ç•Œé¢æ¨¡å—ï¼Œä¸€ä¸ªç½‘ç»œæ¨¡å—å’Œä¸€ä¸ªä¸‹è½½æ¨¡å—ã€‚ç®€å•åœ°è¯´å°±æ˜¯é«˜å±‚ä¸šåŠ¡æ¨¡å—ä¾èµ–äºåº•å±‚æœåŠ¡æ¨¡å—ã€‚è¿™ä¸ª**å•å‘**çš„ï¼Œä»ä¸Šåˆ°ä¸‹çš„ä¾èµ–å°±å«åšå‚ç›´ä¾èµ–ã€‚  
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„åº•å±‚æœåŠ¡æ¨¡å—æ˜¯ç»å¯¹ä¸çŸ¥é“è°ç”¨äº†å®ƒçš„ï¼ˆæ²¡æœ‰å¯¹ä¸Šå±‚ä¾èµ–ï¼‰ï¼Œæ›´ä¸ä¼šå»ä¿®æ”¹è¢«ä¾èµ–æ¨¡å—é‡Œçš„å¯¹è±¡çš„æ•°æ®ã€‚å®ƒåªåšå®ƒä»½å†…çš„äº‹å»æœåŠ¡å¤–ç•Œè€Œä¸å½±å“å¤–ç•Œã€‚  


### 5. é—­åŒ…(block)çš„ä½¿ç”¨
#### Pros:  
ä½¿ç”¨é—­åŒ…æˆ–è€…blockæ˜¯ä¸€ä¸ªéå¸¸å¿«æ·æ–¹ä¾¿çš„æ–¹æ³•æ¥ä¿æŒå„ç§æ“ä½œä»¥ä¾¿æ™šäº›æ—¶å€™ä½¿ç”¨ã€‚  é—­åŒ…"åŒ…é—­"çš„å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡(execution context) -- è®°å½•å½“æ—¶ä»£ç æ‰§è¡Œçš„çŠ¶æ€è¿˜æœ‰æ“ä½œï¼Œæ˜¯å“ªä¸ªåœ°å€ï¼Œå“ªä¸ªå¯¹è±¡ï¼Œå“ªä¸ªå€¼éœ€è¦æ”¹å˜æˆä»€ä¹ˆã€‚ä½ å¯ä»¥æŠŠé—­åŒ…ä¼ æ¥ä¼ å»ï¼Œè°éƒ½å¯ä»¥æ‰§è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚æœ‰ç‚¹åƒå…¶ä»–è¯­è¨€çš„lambdaå‡½æ•°æˆ–è€…åŒ¿åå‡½æ•°ã€‚  

é—­åŒ…ä¹‹æ‰€ä»¥æ–¹ä¾¿å°±æ˜¯å®ƒæœ‰äº†æ‰§è¡Œä¸Šä¸‹æ–‡åï¼Œå®ƒä¸éœ€è¦æä¾›è€…ï¼ˆå®šä¹‰é—­åŒ…çš„æ˜¯æä¾›è€…ï¼Œå†™é—­åŒ…æ“ä½œçš„æ˜¯ä½¿ç”¨è€…ï¼‰å®šä¹‰ä¸€ä¸ªåè®® ç„¶åä½¿ç”¨è€…éµå¾ªåè®®ã€‚æä¾›è€…å®šä¹‰å¥½é—­åŒ…åï¼Œä½¿ç”¨è€…ç›´æ¥å†™ä»–è¦åœ¨é—­åŒ…å†…å¹²ä»€ä¹ˆå°±è¡Œäº†, æä¾›è€…å†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡Œé—­åŒ…ã€‚å¼¹æ€§éå¸¸å¤§ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ[AHServiceRouter](https://github.com/ivsall2012/AHServiceRouter)ï¼Œæˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« ç»„ä»¶åŒ–æ–¹æ¡ˆçš„æ ¸å¿ƒåº“ï¼Œè¿ç”¨é—­åŒ…æ¥æä¾›æ³¨å†Œ(ç»„ä»¶å¯¹å¤–æä¾›çš„æœåŠ¡å’Œæ“ä½œ)çš„åŸå› ã€‚å› ä¸º[AHServiceRouter](https://github.com/ivsall2012/AHServiceRouter)æ ¹æœ¬æ²¡åŠæ³•çŸ¥é“å“ªä¸ªæ¨¡å—éœ€è¦æ³¨å†Œï¼Œå®šä¹‰æ€æ ·çš„åè®®æ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœè¿ç”¨é—­åŒ…ï¼Œå°±ä¸ç”¨å…³å¿ƒè¿™äº›äº†ã€‚ä¸€ä¸ªç»„ä»¶åªè¦æ³¨å†Œçš„æ—¶å€™ï¼Œç»™routerä¸€ä¸ªé—­åŒ…å°±å¯ä»¥äº†ã€‚ç„¶åå½“éœ€è¦çš„æ—¶å€™ï¼Œrouteræ‰§è¡Œé‚£ä¸ªé—­åŒ…ã€‚routeræ ¹æœ¬ä¸å…³å¿ƒé‚£ä¸ªç»„ä»¶éœ€è¦æ€æ ·çš„æ–¹æ³•å’Œæ“ä½œã€‚å¦å¤–ä¸€ä¸ªæ˜¯ç½‘ç»œè¯·æ±‚åº“ï¼Œå¦‚AFNetworking(Alamofire), å®ƒä»¬ä¸çŸ¥é“ï¼Œä¹Ÿä¸å…³å¿ƒæ˜¯è°å‘å‡ºçš„è¯·æ±‚ï¼Œæ›´ä¸çŸ¥é“è¯¥æ€æ ·å¤„ç†è¿”å›çš„ç»“æœï¼Œå› ä¸ºæ¯ä¸ªè¯·æ±‚è€…éƒ½ç”¨ä¸åŒçš„æ•°æ®è½¬æ¢éœ€æ±‚ã€‚æ‰€ä»¥é—­åŒ…å¾ˆé€‚åˆåšç½‘ç»œè¯·æ±‚çš„å›è°ƒã€‚  

å½“ä½ ä½¿ç”¨é“¾å¼çš„é—­åŒ…çš„æ—¶å€™ï¼Œæ¯”å¦‚ä½¿ç”¨ReactiveCocoaæˆ–è€…RxSwiftçš„æ—¶å€™ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæ“ä½œæ¥ç€ä¸€ä¸ªæ“ä½œï¼Œçœ‹å®ƒä»¬çš„ä»£ç è·Ÿçœ‹æ•…äº‹ä¸€æ ·ï¼Œä¸€ä»¶äº‹æ¥ç€ä¸€ä»¶äº‹ -- æ‰€æœ‰äº‹ä»¶å¤„ç†éƒ½é›†ä¸­åˆ°äº†ä¸€ä¸ªåœ°æ–¹ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚  

å½“ç„¶ä¹Ÿæœ‰å…¶ä»–é«˜çº§ç‚«é…·çš„é«˜çº§ç”¨æ³•ï¼Œåœ¨è¿™é‡Œåªæä¸€ä¸ªã€‚  
åœ¨[AHAudioPlayer](https://github.com/ivsall2012/AHAudioPlayer)çš„ä»£ç†æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯éœ€è¦ä»£ç†å¯¹è±¡æä¾›éŸ³é¢‘çš„ä¸“è¾‘å›¾ç‰‡ã€‚ä½†ä»£ç†å¯¹è±¡å¯èƒ½éœ€è¦å‘é€ç½‘ç»œæ¥è·å–å›¾ç‰‡ï¼Œæ‰€æœ‰é‚£ä¸ªä»£ç†æ–¹æ³•æ˜¯è¿™æ ·è®¾è®¡çš„ï¼š  
```Swift
func playerMangerGetAlbumCover(_ player: AHAudioPlayerManager,trackId: Int, _ callback: @escaping(_ coverImage: UIImage?)->Void)
```  
æœ‰å¿…è¦è¯´æ¸…æ¥šçš„æ˜¯ï¼Œè¿™é‡Œçš„å®šä¹‰é—­åŒ…çš„æä¾›è€…æ˜¯â€œAHAudioPlayerâ€ï¼Œå®ƒè‡ªå·±åŒæ ·ä¹Ÿæ˜¯å†™é—­åŒ…æ“ä½œçš„ä½¿ç”¨è€…ã€‚è¿™é‡Œè®©**ä»£ç†å¯¹è±¡**æ¥å†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡Œé—­åŒ…ã€‚ä¸€èˆ¬çš„é—­åŒ…ä½¿ç”¨æ˜¯ï¼Œæä¾›è€…å®šä¹‰é—­åŒ…å’Œå†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡Œé—­åŒ…(è”æƒ³ç½‘ç»œåº“)ï¼Œç„¶åä½¿ç”¨è€…å†™é—­åŒ…æ“ä½œå°±å¯ä»¥äº†ã€‚è¿™é‡Œæ˜¯æŠŠé—­åŒ…æ‰§è¡Œæƒç»™äº†ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å› ä¸ºé—­åŒ…æ˜¯å¯ä»¥ä¼ æ¥ä¼ å»çš„ã€‚   
[AHAudioPlayer](https://github.com/ivsall2012/AHAudioPlayer)ä½œä¸ºæä¾›è€…ï¼Œå®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œè§„å®šä½¿ç”¨è€…åœ¨è·å–åˆ°å›¾ç‰‡åï¼ŒæŠŠå®ƒæ”¾è¿›é—­åŒ…çš„å‚æ•°é‡Œæ‰§è¡Œå°±å¯ä»¥äº†ã€‚â€œAHAudioPlayerâ€åœ¨ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨é‚£ä¸ªä»£ç†æ–¹æ³•çš„æ—¶å€™ï¼Œå°±å·²ç»åˆ›å»ºå¥½äº†é—­åŒ…ç„¶åä¼ è¿›ä»£ç†æ–¹æ³•é‡Œã€‚  


#### Cons:  
é—­åŒ…å»¶é•¿äº†å†…éƒ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œ å®ƒæŠŠå†…éƒ¨çš„å¯¹è±¡çš„ retainCount éƒ½åŠ äº†ä¸ª1ï¼Œä¸åªæ˜¯"self"ã€‚ åªæœ‰æ‰€æœ‰é—­åŒ…å†…çš„æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰é—­åŒ…çš„å¯¹è±¡æ‰ä¼š retainCount-1ã€‚  
é—­åŒ…è¿˜ä¼šå¾ˆå®¹æ˜“å¼•èµ·å¾ªç¯å¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯3æ–¹å¾ªç¯å¼•ç”¨ï¼Œ å¦‚ VC -> obj -> block -> VCã€‚  
è¿˜æœ‰é—­åŒ…èƒ½è¢«ä»»ä½•äººåœ¨ä»»ä½•çº¿ç¨‹ï¼Œä»»ä½•ä¼ é€’å’Œæ‰§è¡Œ -- è¿™ä¸ªå®åœ¨æ˜¯å¤ªå¹¿æ³›äº†ï¼ŒèŒèƒ½ä¸å¤Ÿæ¸…æ™°ï¼Œå¤ªå¤šä¸ç¡®å®šæ€§ã€‚   

#### ä»€ä¹ˆæ—¶å€™ç”¨  
å¦‚æœä½ æœ‰äº‹æƒ…è¦å¤–ç•Œåšï¼Œä½†ä½ åˆä¸æƒ³å®šä¹‰ä¸€ä¸ªåè®®å’Œä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚ï¼Œä½ æƒ³è®©ç”¨æˆ·ç™»å½•åæ‰èƒ½åšæŸæ“ä½œï¼Œé‚£ä¹ˆä½ éœ€è¦ç»™ç™»å½•å™¨ä¸€ä¸ªé—­åŒ…ï¼ˆç™»å½•å™¨å®šä¹‰å¥½çš„ï¼‰ï¼Œç„¶åå½“ç™»å½•å™¨æˆåŠŸç™»å½•åï¼Œå®ƒä¼šå¸®ä½ æ‰§è¡Œé—­åŒ…ã€‚ç™»å½•å™¨æ ¹æœ¬ä¸éœ€è¦çŸ¥é“é—­åŒ…æ˜¯å¹²ä»€ä¹ˆçš„,æœ‰ä»€ä¹ˆå¯¹è±¡ï¼Œå› ä¸ºæ¯æ¬¡ç™»å½•æˆåŠŸåçš„æ“ä½œå¾ˆå¯èƒ½ä¸åŒã€‚  

è¿˜æœ‰ä¸ªå¥½çš„ä¾‹å­ï¼Œå°±æ˜¯ç»„ä»¶åŒ–çš„routerè®¾è®¡ã€‚[AHServiceRouter](https://github.com/ivsall2012/AHServiceRouter)å°±æ˜¯ç”¨é—­åŒ…æ³¨å†ŒæœåŠ¡å’Œä»»åŠ¡çš„ã€‚å®ƒæ ¹æœ¬ä¸å…³å¿ƒè°ä¼šæ³¨å†Œä»€ä¹ˆæœåŠ¡å’Œä»»åŠ¡ï¼Œæ›´ä¸å…³å¿ƒè°éœ€è¦æ‰§è¡ŒæœåŠ¡æä¾›çš„ä»»åŠ¡ã€‚  å®ƒåªçŸ¥é“ä¿å­˜æœåŠ¡å’Œä»»åŠ¡ï¼Œç„¶åå½“æœ‰äººéœ€è¦çš„æ—¶å€™ï¼Œæ‰§è¡Œé‚£ä¸ªæ³¨å†Œå¥½äº†çš„é—­åŒ…å°±å¯ä»¥äº†ã€‚  

NOTE: é—­åŒ…çš„ä¼ å…¥å‚æ•°æœ€å¥½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™æ ·é—­åŒ…çš„æ‰§è¡Œè€…å°±ä¸éœ€è¦å¯¼å…¥é—­åŒ…å‚æ•°å¯¹åº”çš„ç±»ã€‚  

æˆ‘å»ºè®®ä½ å†æ€è€ƒæ˜¯å¦éœ€è¦ç”¨é—­åŒ…çš„æ—¶å€™ï¼ŒæŠŠé—­åŒ…ä½œä¸ºä½ æœ€åçš„é€‰é¡¹ï¼Œå¦‚æœä½ éœ€è¦å¹¿æ’­æ•ˆæœä½ å¯ä»¥ç”¨[å¤šä»£ç†çš„è®¾è®¡æ¨¡å¼](#9-ä¸€ä¸ªå¤šä»£ç†è®¾è®¡æ¨¡å¼)ã€‚



### 6. å±•ç¤ºå±‚
å±•ç¤ºå±‚ï¼Œåœ¨æˆ‘çš„è„‘å­é‡Œå°±æ˜¯æ•´ä¸ªMVCé‡Œä¸æ¶‰åŠç½‘ç»œå’Œåº•å±‚å·¥å…·çš„ä»£ç å±‚æˆ–è€…è¯´æ•´ä¸ªä¸šåŠ¡æ¨¡å—å§ã€‚è¿™ä¸€å±‚æ˜¯ä¸“é—¨å±•ç¤ºæ•°æ®å’Œç”¨æˆ·äº¤äº’çš„ã€‚  
ä½†ä¸€ä¸ªæœ€å¸¸è§çš„ä¸å¥½çš„ä¹ æƒ¯æ˜¯ä½ ä»¬æœ‰äº›æŠŠç½‘ç»œå•Šï¼Œäº‹ä»¶å“åº”å•Šï¼Œé¡µé¢è·³è½¬å…¨éƒ¨å¡åˆ°ä¸€ä¸ªVCé‡Œé¢å»ã€‚æˆ‘çŸ¥é“è¿™æ ·å†™å¾ˆæ–¹ä¾¿ï¼Œç”¨åˆ°ä»€ä¹ˆå¸¦å…¥ä»€ä¹ˆï¼Œç›´æ¥åœ¨VCé‡Œç”¨ä¸å°±å¾—äº†å˜›ï¼Œå¹²å˜›æé‚£ä¹ˆéº»çƒ¦ï¼Ÿ  
ä½†æ˜¯ä½ æƒ³æƒ³å•Šï¼Œä½ å†™çš„ä»£ç åˆä¸æ˜¯ç»™ä½ ä¸€ä¸ªäººçœ‹çš„ï¼Œå¦‚æœä½ ç¦»å¼€è¿™ä¸ªå…¬å¸åï¼Œåé¢çš„äººè¿˜æ˜¯è¦çœ‹çš„å•Šã€‚å°±ç®—æ˜¯ä½ è‡ªå·±å†™çš„ä»£ç ï¼Œå‡ ä¸ªæœˆè¿‡åï¼Œä½ éœ€è¦é‡æ„ä½ çš„ä»£ç ï¼Œä½ å¯èƒ½éƒ½çœ‹ä¸æ‡‚äº†ï¼Œä¸€ä¸ªåˆå¤§åˆè‚¥åˆéš¾çœ‹çš„VCæ‘†åœ¨ä½ é¢å‰ã€‚ã€‚ã€‚  
ä½ åº”è¯¥æŠŠç½‘ç»œè¯·æ±‚ï¼Œäº‹ä»¶å“åº”ï¼Œé¡µé¢è·³è½¬éƒ½äº¤ç»™å¯¹åº”çš„ä¸€ä¸ªå¯¹è±¡æˆ–è€…è¯´helperåˆæˆ–è€…è¯´æ˜¯ä¸€ä¸ªmanageræ¥å¤„ç†ã€‚VCæ˜¯å°±åƒä¸ªé¢†å¯¼ï¼Œä»–çš„èŒèƒ½æ˜¯ç»„ç»‡å¥½å„ä¸ªå›¢é˜Ÿï¼Œè€Œä¸æ˜¯å…³å¿ƒé‚£äº›ç¹æ‚çš„äº‹ï¼Œè¿™äº›äº‹éƒ½åº”è¯¥äº¤ç»™å®ƒçš„å°å–½å•°å»åšã€‚  
è¿™æ ·æˆ‘ä»¬æŠŠä»£ç åˆ†åˆ°ä¸åŒèŒèƒ½çš„å¯¹è±¡ä¸Šï¼Œåˆ†é—¨åˆ«ç±»ï¼Œç»´æŠ¤èµ·æ¥ä¼šè½»æ¾å¥½å¤šã€‚  
ä½ å¯ä»¥ç”¨åè®®å’Œä»£ç†æŠŠå¤„ç†æƒäº¤ç»™å…¶ä»–çš„å¯¹è±¡ã€‚  


### 7. ç½‘ç»œå±‚
2ç§æ–¹æ³•æ¥è®¾è®¡ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“:  
1) ä½¿ç”¨classæˆ–è€…structçš„å•ä¾‹æ¨¡å¼ï¼Œæˆ–è€…å®ƒä»¬çš„static/classæ–¹æ³•æ¥å‘è¯·æ±‚ -- é›†çº¦ç»“æ„ï¼Œæ¯ä¸ªäººéƒ½ç”¨ è¦ä¹ˆæ˜¯ä»åŒä¸€ä¸ªå•ä¾‹é‡Œé¢çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯é™æ€æˆ–ç±»æ–¹æ³•ã€‚    
2) ä¸€ç§æ˜¯æŠŠæ‰€æœ‰æ–¹æ³•åšæˆå¯¹è±¡æ–¹æ³•ï¼Œè°è¦ç”¨éƒ½å¾—å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡, åƒè‹¹æœçš„ç½‘ç»œåº“ç±»URLSessinTask -- ä»–ä»¬éƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå»ºè®®ç”¨è¿™ä¸ªè®¾è®¡ã€‚  

æˆ‘å»ºè®®æ˜¯æ¯ä¸ªVCæœ‰ä¸€ä¸ªç‰¹å®šçš„NetworkMangerçš„å¯¹è±¡æ¥è¯·æ±‚ç½‘ç»œèµ„æºå’Œæ•°æ®å¤„ç†ã€‚åœ¨è¿™ä¸ªNetworkMangeré‡Œï¼Œä¼šæœ‰ä½ çš„ç½‘ç»œåº“å¯¹è±¡ã€‚  
é‚£ä¹ˆå½“VCè¢«é”€æ¯çš„æ—¶å€™ï¼Œé‚£ä¸ªNetworkMangerä¹Ÿä¼šè¢«é”€æ¯ï¼Œåœ¨deinité‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç½‘ç»œåº“å¯¹è±¡å–æ¶ˆæ‰€æœ‰çš„è¯·æ±‚ã€‚   
```Swift
class NetworkManger: SomeProtocol {
    // ç½‘ç»œåº“å¯¹è±¡
    lazy var networking = NetworkingObject()

    deinit {
        networking.cancelAllRequests()
    }
    // VCè°ƒç”¨çš„ä»£ç†æ–¹æ³•çš„å®ç°
    func viewController(_ vc: theViewController, shouldLoadUserDataForUserId userId: Int) {
        // check cache...
        // vcè¿™é‡Œå¿…éœ€æ˜¯å¼±çš„å¼•ç”¨ï¼Œå› ä¸ºå¦‚æœvcéƒ½æ­»äº†ï¼Œå°±è¯´æ˜è¿™ä¸ªNetworkMangerä¹Ÿå·²ç»æ­»äº†ï¼Œnetworkingå¯¹è±¡ä¹Ÿå°±æ­»äº†ã€‚  
        networking.requestUserData(byUserId userId) {[weak vc] (data) in
            // æ£€æŸ¥vcæ˜¯å¦ä¸ºnil
            guard let vc = vc else {return}
            guard let data = data else {return}
            // data transforming....
            // notify vc the data is ready
            vc.reload(data)
        }
    }
}
```  

### 8. æœ¬åœ°æŒä¹…åŒ–
æˆ‘ä»¬è¿™é‡Œåªç®€å•èŠèŠæ•°æ®åº“ï¼ŒUserDefault,KeyChianå’ŒNSKeyedArchiverä¹‹ç±»çš„éƒ½åªé€‚åˆå­˜å‚¨å°æ•°æ®ã€‚  
æˆ‘ä¸ªäººæ˜¯æ¯”è¾ƒå–œæ¬¢â€œå»modelåŒ–â€çš„ï¼ˆGoogleï¼Œç™¾åº¦ä¸€ä¸‹ å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼‰ï¼Œæˆ‘åªä¼ éœ€è¦çš„åŸºæœ¬ä¿¡æ¯ã€‚å¦‚æœå¦ä¸€ä¸ªæ¨¡å—éœ€è¦å®Œæ•´çš„æ•°æ®ï¼Œå¯ä»¥è‡ªå·±å»æ•°æ®åº“å–ã€‚  
æ•°æ®åº“åœ¨ç»™æ•°æ®çš„æ—¶å€™ä¹Ÿæ˜¯åªç»™ä¸€ä¸ªå­—å…¸ï¼Œç„¶åé‡Œé¢è£…çš„éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€‚â€œå»modelåŒ–â€å¯ä»¥ç»™æ¨¡å—æ›´å¤šçš„ç‹¬ç«‹æ€§ï¼Œå®ƒå¯ä»¥æœ‰å†…éƒ¨å®šä¹‰çš„modelï¼Œä½†å®ƒç»ä¸ç”¨å¤–ç•Œæä¾›çš„å…±äº«modelã€‚å› ä¸ºå¸¦ç€ä¸€ä¸ª æ•´ä¸ªé¡¹ç›®å…±äº«çš„modelï¼Œæµ‹è¯•èµ·æ¥æ¯”è¾ƒåˆ«æ‰­è€Œä¸”ç§»æ¤æ€§å¾ˆä¸å¥½ã€‚  
å¾ˆå¤šæ—¶å€™ï¼Œå­—å…¸å°±å¯ä»¥æŠŠä¿¡æ¯å¸¦åˆ°ä¸‹ä¸€ä¸ªæ¨¡å—äº†ã€‚  
å½“ç„¶å¦‚æœç”¨å…¨å±€å…±äº«æ¨¡å‹çš„è¯ï¼Œè¿˜æ˜¯å¾ˆçˆ½çš„ã€‚ä½†æ²¡åŠæ³•ï¼Œä¸€åˆ‡éƒ½ä¸ºäº†æ›´å¥½çš„ç»´æŠ¤æ€§ã€‚  
æˆ‘çš„é¡¹ç›®[AHFM](https://github.com/iOSModularization/AHFM)é‡Œï¼Œåªæœ‰åœ¨æ¨¡å—é‡Œçš„Managerå±‚ï¼ˆåŒ…æ‹¬äº†ç½‘ç»œå’Œæœ¬åœ°æ•°æ®æŒä¹…åŒ–ï¼‰é‡Œæœ‰æ•°æ®åº“çš„æ¨¡å‹ï¼Œè€Œä¸”æ˜¯åªåœ¨é‚£é‡Œæœ‰ã€‚ä¸ä¼šåœ¨æ¨¡å—é‡Œçš„å±•ç¤ºå±‚æœ‰ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦åå¤æµ‹è¯•å±•ç¤ºå±‚

#### CoreData   
ä¸ªäººæ„Ÿè§‰CoreDataæœ‰ç‚¹è¿‡åº¦è®¾è®¡äº†ï¼Œæˆ–è€…è¯´å¤ªæ•£äº†ã€‚ä½†æ˜¯å®ƒæä¾›çš„æ¨¡å‹åŒ–åŠŸèƒ½ï¼ŒNSFetchedResultsController éƒ½è›®ä¸é”™çš„ã€‚
è¿˜æœ‰å®ƒçš„managedObjectContextæœ‰ç‚¹å±é™©ï¼Œå¦‚æœä½ æš´éœ²å‡ºå»çš„è¯ã€‚æœ€å¥½ä¸è¦æŠŠæ¨¡å‹ç›¸å…³çš„å¯¹è±¡æš´éœ²å‡ºå»ã€‚æ•°æ®æ¨¡å‹ä¸åº”è¯¥å‡ºç½‘ç»œå’Œæ•°æ®å±‚ã€‚  

#### Realm
[AHFM](https://github.com/iOSModularization/AHFM)çš„ç¬¬ä¸€ç‰ˆå°±æ˜¯ç”¨Realmçš„ã€‚ 
çœŸçš„å¾ˆå®¹æ˜“ç”¨ï¼ŒèŠ±é‚£ä¹ˆ3-4ä¸ªå°æ—¶é˜…è¯»å®˜æ–¹çš„æ–‡æ¡£ï¼Œä½ å°±å¯ä¸Šäº†ã€‚  
ä½†æˆ‘åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒRealmæŠŠæˆ‘ç»™æŠ˜ç£¨å¾—ã€‚ã€‚ã€‚   
Realmçš„æ¯ä¸€ä¸‹ç¼–è¯‘éƒ½è‡³å°‘3ã€4åˆ†é’Ÿï¼Œæœ‰æ—¶å€™5åˆ†é’Ÿã€‚åˆå› ä¸ºå‡ ä¹æ¯ä¸€ä¸ªæ¨¡å—éƒ½ç”¨åˆ°ç½‘ç»œåº“ï¼Œåˆè¦æŠŠæ¨¡å—pushåˆ°ç§æœ‰repoé‡Œ ä¹Ÿéœ€è¦ç¼–è¯‘ä¸€æ¬¡ï¼Œè¿™ç®€ç›´éƒ½å¿«æŠŠæˆ‘å¼„ç–¯äº†ã€‚AHFMä¸€å…±æœ‰10ä¸ªä¸»æ¨¡å—å•Šã€‚    
ç„¶åæˆ‘å°è¯•ç€æŠŠRealmçš„frameworkæ‰“åŒ…è¿›ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œè¿™æ ·çš„è¯å°±çœäº†ç¼–è¯‘çš„æ—¶é—´ã€‚  
ä½†å¾ˆä¸å¹¸çš„æ˜¯ï¼Œä¸€æ—¦æŠŠRealmçš„frameworkåŒ…æ‹¬åˆ°å•ç‹¬çš„podæ¨¡å—ï¼Œç¼–è¯‘å°±æ˜¯ä¸è¿‡ã€‚ä½ å¯ä»¥çœ‹æˆ‘çš„[issue](https://github.com/realm/realm-cocoa/issues/5230)ã€‚   
ç„¶åæ²¡åŠæ³•ï¼Œè‡ªå·±ç”¨SQLiteå†™äº†ä¸€ä¸ªå°è£…åº“ï¼Œè¿˜æ˜¯å¸¦æ¨¡å‹æ“ä½œå’Œæ•°æ®è¿ç§»çš„ã€‚æ„Ÿè§‰è¿˜ä¸é”™ã€‚    
[AHDataModel](https://github.com/ivsall2012/AHDataModel)   
NOTE: OCè²Œä¼¼æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥æ‰“åŒ…æˆé™æ€åº“ã€‚  

#### SQLite
[AHDataModel](https://github.com/ivsall2012/AHDataModel)ï¼Œ [SQLite.swift](https://github.com/stephencelis/SQLite.swift)å’Œ[GRDB.swift](https://github.com/groue/GRDB.swift) éƒ½å¾ˆä¸é”™ï¼Œæ‹¿æ¥ç›´æ¥ç”¨äº†ï¼Œå¦‚æœä½ æ¯”è¾ƒç†Ÿæ‚‰SQLçš„è¯ã€‚  
å¦‚æœä½ å…³å¿ƒå“ªä¸ªæ•°æ®åº“å¿«çš„è¯ï¼Œæˆ‘è§‰å¾—æœ‰ç‚¹æ²¡å¿…è¦ã€‚å› ä¸ºç§»åŠ¨åº”ç”¨ä¸åƒæœåŠ¡å™¨ï¼Œä¸€èˆ¬çš„åº”ç”¨ä¸ä¼šè¾¾åˆ°è¯´å› ä¸ºæ•°æ®åº“çš„é€Ÿåº¦æ…¢è€Œæ‹–æ…¢æ•´ä¸ªåº”ç”¨ã€‚ å¦‚æœçœŸæ˜¯è¿™æ ·ï¼Œæ­å–œä½ ï¼Œä½ çš„å…¬å¸å‰é€”æ— é‡å•Šï¼  

  

#### æ€æ ·åˆ‡å‰²æ•°æ®æ¨¡å‹
ä¸‹é¢æˆ‘è§‰å¾—æœ‰å¿…è¦è¯´ä¸€ä¸‹æ•°æ®çš„åˆ‡å‰²ã€‚å› ä¸ºæˆ‘ä¹‹å‰è¯•è¿‡ï¼Œæ•´ä¸ªé¡¹ç›®éƒ½ç”¨ä¸€ä¸ªæ¨¡å‹æ¥æ“ä½œï¼Œå„ç§ç›¸å…³çš„å±æ€§éƒ½åœ¨é‡Œé¢ã€‚ä½†éšç€é¡¹ç›®æ…¢æ…¢å˜å¤§ï¼Œæ¨¡å‹çš„å±æ€§è¢«å„ä¸ªæ¨¡å—ä¿®æ”¹ï¼Œæœ€ç»ˆå­˜åˆ°æ•°æ®åº“é‡Œçš„æ•°æ®å¾ˆå¯èƒ½å°±ä¸æ­£ç¡®äº†ã€‚  
å› ä¸ºè¿™ä¸ªæ¨¡å‹çš„èŒèƒ½æ˜¯ä¸æ¸…æ™°çš„ï¼Œå…¶ä»–æ¨¡å—è§‰å¾—æ–¹ä¾¿å°±æ”¹ï¼Œç„¶åéƒ½å¾€æ•°æ®åº“é‡Œä¸€æ‰”ã€‚æ•°æ®å¾ˆå®¹æ˜“è¢«æ±¡æŸ“ã€‚è€Œä¸”åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¿…è¦ä¸å¿…è¦çš„æ•°æ®å…¨åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¤šä½™ å å†…å­˜ã€‚  
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸æŠŠæœ¬åœ°æ·»åŠ çš„å±æ€§è·ŸåŸå§‹æ•°æ®çš„å±æ€§æ··åœ¨ä¸€èµ·çš„ï¼Œæ¯”å¦‚ artistNameå’ŒplayedProgress.  artistNameæ˜¯ä»æœåŠ¡å™¨æ¥çš„åŸå§‹æ•°æ®ï¼Œè€ŒplayedProgressæ˜¯å¼€å‘è€…è‡ªå·±åœ¨æœ¬åœ°åŠ ä¸Šå»çš„ã€‚  
å¦‚æœä¸€ä¸ªæ¨¡å—éœ€è¦ä¿æŒæ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±åº”è¯¥æœ‰è‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚  
åœ¨ä¸Šé¢çš„artistNameå’ŒplayedProgressä¾‹å­ï¼ŒartistNameå¯ä»¥åœ¨ä¸€ä¸ªåŸå§‹æ•°æ®æ¨¡å‹SongModelé‡Œé¢ã€‚è€ŒplayedProgresså¯ä»¥è¢«å¼€å‘éŸ³é¢‘æ¨¡å—çš„åŒäº‹åˆ›å»ºä¸€ä¸ªAudioCacheçš„æ¨¡å‹ã€‚ playedProgressä½œä¸ºæ’­æ”¾ç¼“å­˜ï¼Œç”¨SongIdä½œä¸ºidï¼Œè¿™æ ·å¦‚æœæŸ¥è¯¢è¿™ä¸ªAudioCacheå¯¹åº”çš„æ˜¯å“ªä¸ªåŸå§‹æ•°æ®æ¨¡å‹çš„è¯ï¼Œç”¨SongIdä½œä¸ºIDå»æŸ¥å°±å¯ä»¥äº†ã€‚  

ç¤ºä¾‹ç¨‹åº [AHFMDataCenter](https://github.com/iOSModularization/AHFMDataCenter)  
NOTE: AHFMShowå’ŒAHFMEpisodeæ˜¯2ä¸ªåŸå§‹æ•°æ®æ¨¡å‹ã€‚å…¶ä»–çš„æ˜¯æœ¬åœ°æ•°æ®æ¨¡å‹ã€‚å…¶å®æ¯ä¸€ä¸ªæœ¬åœ°æ•°æ®æ¨¡å‹åº”è¯¥è¢«åšæˆä¸€ä¸ªpodï¼Œè¿™æ ·å“ªä¸ªæ¨¡å—éœ€è¦å“ªä¸ªæ¨¡å‹ï¼Œå¯¼å…¥å°±å¯ä»¥äº†ã€‚ä¸è¦åƒè¿™ä¸ªAHFMDataCenterä¸€æ ·ï¼Œæ‰€æœ‰æ¨¡å‹éƒ½åœ¨ä¸€ä¸ªpodé‡Œï¼Œä¸€å¯¼å…¥ï¼Œæ‰€æœ‰æ¨¡å‹éƒ½è¢«å¯¼å…¥äº†ã€‚   

æ— è®ºåŸå§‹è¿˜æ˜¯æœ¬åœ°æ•°æ®æ¨¡å‹éƒ½ä¸åº”è¯¥è¢«ç½‘ç»œå’Œæ•°æ®å±‚ä»¥å¤–çš„å±‚æˆ–æ¨¡å—ä½¿ç”¨ã€‚  
å»ºè®®æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½æœ‰è‡ªå·±çš„ç½‘ç»œå’Œæ•°æ®å±‚ã€‚ä¸€ä¸ªæ¨¡å—å¯ä»¥ç”±ç½‘ç»œ/æ•°æ®å±‚å’Œå±•ç¤ºå±‚ç»„æˆã€‚æ¯ä¸ªå±‚å¯ä»¥æ˜¯ä¸€ä¸ªpodã€‚  
å±•ç¤ºå±‚é—®ç½‘ç»œ/æ•°æ®å±‚è¦æ•°æ®ï¼Œç½‘ç»œ/æ•°æ®å±‚å¤„ç†äº‹ä»¶å’Œé€šçŸ¥å±•ç¤ºå±‚æ•°æ®å‡†å¤‡å¥½äº†ã€‚  
äº†è§£æ›´å¤šè¯·ç§»æ­¥[the Service Router Architecture(SRA)](https://github.com/ivsall2012/A-Highly-Distributed-Architecture-for-Large-scale-Collaborations/blob/master/SRA.md)   


#### æ€æ ·æŠŠJSONè½¬æˆåŸå§‹æ¨¡å‹
åœ¨ç½‘ç»œå°è£…åº“é‡Œï¼Œå…ˆç”¨å¼€æºåº“,å¦‚SwiftJSONæˆ–è€…MJExtension, æŠŠæœåŠ¡å™¨è¿”å›çš„JSONè½¬æˆarrayæˆ–è€…dictionary.  
è¿™æ ·ï¼Œåœ¨â€œç½‘ç»œ/æ•°æ®å±‚â€é‡Œï¼Œç”¨ä½ çš„è¿™ä¸ªç½‘ç»œå°è£…åº“çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿åˆ°äº†åŸºæœ¬æ•°æ®ç±»å‹çš„arrayæˆ–è€…dictionaryã€‚  
ä½ è¿˜éœ€è¦æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªdata transformerã€‚ è¿™äº›transformerçš„ä½œç”¨æ˜¯æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„æ•°æ®è½¬æˆæ•°æ®åº“æ¨¡å‹ã€‚  
ä¹‹æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªtransformerï¼Œæ˜¯å› ä¸ºå¦‚æœæœåŠ¡å™¨æ”¹äº†å­—æ®µåç§°ï¼Œæˆ‘ä»¬åªè¦æ‹¿åˆ°transformeræ”¹å°±å¥½ã€‚å¤–é¢æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å­—æ®µæ”¹åäº†ã€‚
è¿™æ ·å°±æŠŠæ•°æ®è½¬æ•°æ®æ¨¡å‹çš„è¿‡ç¨‹ç›¸å¯¹ç‹¬ç«‹å‡ºæ¥äº†ã€‚  

æœ‰äº†æ•°æ®æ¨¡å‹ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬å­˜è¿›æ•°æ®åº“ã€‚  
åˆ°è¿™é‡Œï¼Œç½‘ç»œè¯·æ±‚çš„æ•°æ®å°±å·²ç»åˆ°è¾¾æœ¬åœ°çš„æ•°æ®åº“äº†ã€‚ä¸‹ä¸€æ­¥æ˜¯æŠŠå®ƒä»¬è¯»å–å‡ºæ¥ã€‚  
å¦‚æœä½ ç”¨çš„æ˜¯[AHDataModel](https://github.com/ivsall2012/AHDataModel)ï¼Œé‚£ä¹ˆæ•°æ®å‡ºæ¥åå°±æ˜¯æ•°æ®æ¨¡å‹äº†ã€‚  
ç°åœ¨è¿™äº›æ•°æ®æ¨¡å‹è¿˜æ˜¯åœ¨â€œç½‘ç»œ/æ•°æ®å±‚â€é‡Œã€‚ä¸‹ä¸€æ­¥æ˜¯æŠŠå®ƒä»¬ç»™â€œå»modelâ€åŒ– -- åªæŠŠå¿…è¦ä¿¡æ¯çš„åŸºæœ¬æ•°æ®ç±»å‹ç”¨dictinaryæˆ–arrayä¼ é€’åˆ°å±•ç¤ºå±‚ã€‚  
å¦‚æœä½ ç”¨çš„æ•°æ®å°è£…åº“æ˜¯[AHDataModel](https://github.com/ivsall2012/AHDataModel)ï¼Œé‚£ä¹ˆå®ƒçš„åè®®æ—©å°±è¦æ±‚æä¾› æ¨¡å‹->dictçš„æ–¹æ³•äº†ã€‚  
å¦‚æœå¿…è¦ï¼Œè¦æŠŠè¿™äº›ä»æ¨¡å‹åˆ°dictçš„æ•°æ®å’Œç°æœ‰çš„æœ¬åœ°æ•°æ®æ¨¡å‹(å¦‚ ä¸‹è½½è¿›åº¦ï¼Œæ’­æ”¾è¿›åº¦ç­‰)mergeæˆä¸€ä¸ªdictã€‚è¿™ä¸ªå·¥ä½œä¹Ÿæ˜¯åœ¨â€œç½‘ç»œ/æ•°æ®å±‚â€é‡Œåšçš„ã€‚  
å±•ç¤ºå±‚åªçŸ¥é“è¦ä»€ä¹ˆæ•°æ®å’Œä»€ä¹ˆæ—¶å€™è¦ã€‚ä½œä¸ºâ€œç½‘ç»œ/æ•°æ®å±‚â€ï¼Œå®ƒåº”è¯¥æŠŠæ‰€æœ‰æ•°æ®éƒ½æŒ‰ç…§å±•ç¤ºå±‚è¦æ±‚çš„æ ¼å¼æŠŠæ•°æ®ä¼ é€’åˆ°å±•ç¤ºå±‚é‡Œã€‚  

ç¤ºä¾‹:      
**data transformer**: [AHFMDataTransformers](https://github.com/iOSModularization/AHFMDataTransformers)  
**ä¸€ä¸ªç½‘ç»œ/æ•°æ®å±‚**: [AHFMShowPageManager](https://github.com/iOSModularization/AHFMShowPageManger)  
é…å¥—çš„å±•ç¤ºå±‚[AHFMShowPage](https://github.com/iOSModularization/AHFMShowPage)  
**å¦ä¸€ä¸ªç½‘ç»œ/æ•°æ®å±‚**: [AHFMAudioPlayerVCManager](https://github.com/iOSModularization/AHFMAudioPlayerVCManager)  
é…å¥—çš„å±•ç¤ºå±‚[AHFMAudioPlayerVC](https://github.com/iOSModularization/AHFMAudioPlayerVC)  


### 9. ä¸€ä¸ªå¤šä»£ç†è®¾è®¡æ¨¡å¼
Q: ä»€ä¹ˆæ˜¯å¤šä»£ç†ç³»ç»Ÿ?  
A: å¤šä»£ç†è®¾è®¡æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ç®¡ç†å¤šä¸ªä»£ç†çš„è®¾è®¡æ¨¡å¼ã€‚æˆ‘ä»¬æ—¥å¸¸ç”¨çš„ä»£ç†éƒ½æ˜¯ä¸€å¯¹ä¸€ä¸ªä»£ç†æ¨¡å¼ï¼Œ æ¯”å¦‚ä¸€ä¸ªVCéœ€è¦ä¸€ä¸ªä»£ç†é€šçŸ¥å¤–ç•Œåšäº‹æƒ…ã€‚å¤šä»£ç†è®¾è®¡æ¨¡å¼æ˜¯æ”¯æŒä¸€å¯¹å¤šçš„ï¼ŒæŠŠäº‹ä»¶å¹¿æ’­å‡ºå»ã€‚  

Q: é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ç”¨å¤šä»£ç†è®¾è®¡æ¨¡å¼?  
A: å½“ä½ æƒ³ç”¨å¤šä¸ªä»£ç†æ¥æ›¿æ¢Notificationçš„æ—¶å€™ã€‚å¤šä»£ç†è®¾è®¡æ¨¡å¼ä¸Notificationçš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œåœ¨Notificationæ¨¡å¼ä¸­ï¼Œä½ åªéœ€è¦çŸ¥é“Notificationçš„åå­—å°±å¯ä»¥é€šè¿‡NotificationCenteræ¥ç›‘å¬äº‹ä»¶ã€‚  
ä½†å¤šä»£ç†è®¾è®¡æ¨¡å¼éœ€è¦å¯¼å…¥åè®®å’Œæ‹¥æœ‰ä»£ç†çš„é‚£ä¸ªå¯¹è±¡ï¼Œå¦‚ XXX.delegate = self æˆ–è€… XXX.addDelegate(self), è¿™é‡Œä½ éœ€è¦å¯¼å…¥XXXå¯¹åº”çš„ç±»æˆ–åº“ã€‚  

åœ¨è®¾è®¡è¿‡ç¨‹ä¸­çš„2ä¸ªå›°éš¾:  
* æ€ä¹ˆæ ·è®©æ‰€æœ‰åŠ è¿›æ¥çš„ä»£ç†ä¿æŒ**å¼±å¼•ç”¨**   
æ— è®ºåœ¨Swifté‡Œè¿˜æ˜¯OCé‡Œï¼ŒArrayæˆ–è€…Dictionaryæ€»æ˜¯ä¼šå¯¹å®ƒé‡Œé¢çš„å¯¹è±¡æŒæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å¤šä»£ç†æ¨¡å¼ä¹Ÿæ˜¯ä»£ç†æ¨¡å¼çš„ä¸€ç§ï¼Œç»å¯¹ä¸å…è®¸æœ‰å¼ºå¼•ç”¨çš„ä»£ç†å¯¹è±¡ã€‚  
è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä»£ç†å®¹å™¨æ¥å¼±å¼•ç”¨é‚£äº›ä»£ç†å¯¹è±¡ã€‚ è¿™æ ·åœ¨è¿™ä¸ªæ¨¡å¼é‡Œï¼Œåªå¯¹å®¹å™¨äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œè€Œä»£ç†å¯¹è±¡æ˜¯è—åœ¨å®¹å™¨é‡Œçš„ä¸€ä¸ªå¼±å¼•ç”¨ -- ä»£ç†å¯¹è±¡æ­»äº†ä¹Ÿæ²¡å…³ç³»äº†ã€‚  

* æ€ä¹ˆæ ·åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ç§»é™¤ä»£ç†ï¼Ÿ
æˆ‘ä»¬åªéœ€è¦åœ¨æ·»åŠ ä»£ç†çš„æ—¶å€™ï¼Œåœ¨æ‰€æœ‰æ“ä½œæ”¾åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„serialé˜Ÿåˆ— é‡Œé¢å»ï¼Œç„¶åç§»é™¤å·²ç»è¢«é”€æ¯çš„ä»£ç†å¯¹è±¡çš„ä»£ç†å®¹å™¨ã€‚  

ä»¥ä¸‹æ˜¯Swiftçš„å®ç°ï¼Œå¦‚æœæ˜¯OCçš„è¯ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªclassä½œä¸ºå®¹å™¨ã€‚  
Example codes:  
```Swift
public protocol MonitorDelegate: NSObjectProtocol{
    // ä»£ç†æ–¹æ³•
}

internal struct DelegateContainer {
    var delegate: MonitorDelegate?
}

public class Monitor: NSObject {
    // è‡ªå®šä¹‰serialé˜Ÿåˆ—
    fileprivate static var queue = DispatchQueue(label: "MonitorQueue")
    // ç”¨å­—å…¸æ¥å­˜å‚¨ä»£ç†å®¹å™¨
    fileprivate static var delegateDict = [String: DelegateContainer]()
    
    // è¿™ä¸ªMonitorå¯ä»¥æ˜¯ä¸€ä¸ªå•ä¾‹
    public let shared = Monitor()
    
    public static func addDelegate(_ delegate: MonitorDelegate) {
        // ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰æ“ä½œéƒ½ä¸¢åˆ°è‡ªå®šä¹‰çš„é˜Ÿåˆ—é‡Œã€‚  
        self.queue.async {
            /// ç”¨æ¥å­˜å‚¨éœ€è¦ç§»é™¤çš„ä»£ç†å®¹å™¨ã€‚ æˆ‘ä»¬ç”¨UUIDä½œä¸ºä»£ç†å®¹å™¨çš„keyã€‚  
            var neededToRemove = [String]()
            for (offset: _, element: (key: uuid, value: delegateContainer)) in self.delegateDict.enumerated() {
                if delegateContainer.delegate === delegate {
                    // duplicate
                    return
                }
                if delegateContainer.delegate == nil {
                    neededToRemove.append(uuid)
                }
            }
            
            for i in neededToRemove {
                self.delegateDict.removeValue(forKey: i)
            }
            /// ä¹‹æ‰€ä»¥æˆ‘ä»¬ä¸ç”¨Array,æ˜¯å› ä¸ºæ¯ç§»é™¤ä¸€ä¸ªä»£ç†å®¹å™¨ï¼Œæ¯ä¸ªå…ƒç´ çš„indexéƒ½ä¼šå˜ã€‚æ‰€ä»¥å¹²è„†å°±ç”¨å­—å…¸+UUIDäº†ã€‚  
            let uuid = UUID().uuidString
            let container = DelegateContainer(delegate: delegate)
            self.delegateDict[uuid] = container
        }
    }
    // æ¨¡æ‹Ÿä¸€ä¸ªä¸‹è½½å™¨çš„ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„æ–¹æ³•
    func didReceiveData(_ data: Data, size: UInt) {
        for container in self.delegateDict.values {
            container.delegate?.monitor(self, didReceiveData:data, size: size)
        }
    }
}
```

ä¸€ä¸ªä¸‹è½½å™¨æ¡ˆä¾‹å°±æ˜¯ç”¨äº†è¿™ä¸ªå¤šä»£ç†æ¨¡å¼æ¥ç»™å¤–ç•Œç›‘å¬ä¸‹è½½è¿›åº¦çš„:  
[AHDownloader](https://github.com/ivsall2012/AHDownloader)


## Conclusion
Introducing [the Service Router Architecture(SRA)]()